# 4.2

### Luogu#4219. 大融合

[luogu#4219](https://www.luogu.com.cn/problem/P4219). 

题目大意：

给定 $n$ 个点，你需要维护两种操作：

1. 加边，保证加边后原图仍然是森林。
2. 询问 $(x, y)$ 这条边两边 size 乘积，保证边存在。

$n \le 10^5$。

---

动态连边考虑 lct，由于要维护子树信息，考虑对虚儿子整体维护信息，其实这很类似 ddp。

直接维护 `siz[x], siz2[x]` 分别表示真正的 siz 和虚儿子 siz，剩下的我也不知道怎么讲了，你就对着 lct 的板子改一改，需要切换虚实的时候维护一下就行了。

[Submission(0)](https://loj.ac/s/1430219). 

在调试 rotate 的那个 bug 时(代码中已注明)，我确信看到了 0 有父亲并且 0 的 siz 是 1 过，虽然我不知道他的 siz 是什么时候更新的，但是就算不清空 0 节点也可以通过，不过还是清空更为保险一点(

# 4.3

### Luogu#6240. 好吃的题目

题目大意：

多次询问，区间背包。

$n \le 4 \times 10^4, m \le 2 \times 10^5, h_i, t_i \le 200, w_i \le 10^7$。

~~相信大家都猜到了~~，$n, m$ 分别表示物品个数以及询问个数，$h, w$ 分别表示体积和价值，$t$ 表示每次询问的背包大小。

---

只需要离线分治就行了，感觉这题想到分治就结束了，分治背包，对于每个分治区间，跑前后缀，对于被其分割的询问，直接回答，总复杂度为 ${\cal O}(tn \log n + qt)$，空间复杂度大概可以优化到 ${\cal O}(m + nt)$。

并不明白为什么空间爆掉了。

### SP1812. LCS2

[sp1812](https://www.luogu.com.cn/problem/SP1812). 

题目大意：

泻药，多串求最长公共子串。

$n \le 10, |s_i| \le 10^5$。

时间限制：236ms。

空间限制：1.46G。

---

这时空限制略显诡异啊？

考虑使用 sam，我们挑一个最短的串建立 sam，接下来拿所有串在上面跑，如果匹配失败了就跳 fail 指针，并重置当前匹配长度为跳到的点的 `len`，然后对于每个节点记录最大 len，然后注意到一个等价类如果可以被匹配到，则 fail 里的串都可以被匹配到，所以在子树里再取 max，最后对自己的长度取 min，这样就得到了这个串匹配每个节点的最大值，对于所有串的结果取 min，然后取全局 max 就好了。

> 如果不好理解的话可以理解为 sam 其实是一个串所有子串的 ac 自动机。

至于时间复杂度，每次跳 fail 相当于至少除去前面一个字符，考虑 kmp 的想法就是了，所以总复杂度是 $\sum |s_i|$ 的。

