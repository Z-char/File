$\newcommand\lr[3]{\left#1 #3 \right#2}$ 

#### 问题引入

~~随着时代的进步，人们日益增长的出毒瘤数论题需要和线性筛不够快的冲突已经成为现今 OI 的主要冲突~~。

因为这是筛法题，所以你需要求出这样一个东西：
$$
ans = \sum_{i = 1}^n f(i)
$$
其中 $n \le 10^{10}$，并且保证 $f(i)$ 是一个积性函数。

特别的，本题中的 $f(i)$ 满足 $f(p)$ 是一个关于 $p$ 的低阶多项式($p$ 指质数)，并且 $f(p^e)$ 可以快速求出。

#### min_25 筛

特殊处理 $f(1)$。

令 $F_k(n) = \sum_{i=2}^n [p_k \le {\rm minp(i)}] f(i)$，即最小质因子不小于第 $k$ 个质数的 $f$ 和。

那么 $ans = f(1) + F_1(n)$。

注意，$a/b$ 表示 $a$ 除以 $b$ 下取整。

考虑：
$$
\begin{aligned}
F_k(n) &= \sum_{i=2}^n [p_k \le {\rm minp(i)}] f(i) \\
&= \lr(){\sum_{\substack{i \ge k\\p_i^2 \le n}} \sum_{\substack{c\ge 1\\p_i^c \le n} } f(p_i^c) ([c\gt1] + F_{i+1}(n/p_i^c))} + F_{prime}(n) - F_{prime}(p_{k-1}) \\ 
&= \lr(){\sum_{\substack{i\ge k \\p_i^2 \le n}}\sum_{\substack{c\ge 1\\p_i^{c + 1} \le n}} f(p_i^c)F_{i+1}(n/p_i^c)+f(p_i^{c + 1})} + F_{prime}(n) - F_{prime}(p_{k - 1})
\end{aligned}
$$
其中 $F_{prime}(n) = \sum_{i=2}^n f(i) [\rm i~is~prime]$。

那么第一步是定义，第二步是分素数合数讨论，对于素数，最小质因子 $\ge p_k$ 的就是那些质数，对于合数，暴力枚举最小质因子，由于是合数，最小质因子不应该超过 $\sqrt n$，然后枚举次数，若次数不为 $1$，那么有合数 $p_i^c$，否则没有，至于多质因数，由于积性函数，那么直接提取 $f(p_i^c)$，剩余部分可以理解为 $n/p_i^c$ 里面选质因数至少为 $i + 1$ 的结果。

第三步考虑 $t$，使得 $p_i^t \le n, p_i^{t + 1} \gt n$，不难发现我们的 $c$ 枚举范围是 $1 \to t$，而前一部分贡献在 $2 \to t$，后一部分贡献在 $1 \to t$，然而注意到若 $p_i^{t + 1} \gt n$，那么 $n / p_i^{t}$ 不会能选出来 $p_{i + 1}$ 以上的素数的，那么贡献是 $0$，所以后一部分有贡献的位置实际上是 $1 \to t - 1$，那么我们枚举 $1 \to t - 1$，让前一部分贡献 $i + 1$，后一部分贡献 $i$，恰好和原来贡献相同。

据信，直接按照递推式计算的复杂度为 ${\cal O}\lr(){\dfrac{n^{3/4}}{\log n}}$。

由于我们要求 $F_1(n)$，柿子中 $f$ 仅涉及 $p^k$，故可以快速计算，柿子中 $F$ 的下标不会很大，因为访问的值必须满足 $p_i^2 \le n$，就算不要求是质数，合法的值也只有 $\sqrt n$ 个，至于 $F$ 括号里面的值也不会很多，最多只有 $\sqrt n$ 级别，这是整除分块经典结论，后面的 $F_{prime}$ 括号里的值个数只有 $F$ 括号里的值 + $F$ 的下标级别，所以只有 $\sqrt n$，并且后面的 $F_{preim}(p_{k-1})$ 括号里面的值不会超过 $\sqrt n$，这是因为下标不会超过 $\sqrt n$，那么可以直接线性筛，筛出 $\sqrt n$ 以下的质数以及其 $F_{prime}$，后面的部分就解决了，现在唯一的问题就是如何计算所有的 $F_{prime}(n/i)$。

注意到 $f(p)$ 是关于 $p$ 的低阶多项式。

那么直接对每个次数求 $p$ 的贡献和，现在的问题变成了给定 $g(i) = i^s$，求 $\sum_{i=2}^n g(i) [{\rm i~is~prime}]$。

设 $g(n, k)$ 表示 $\sum_{i=2}^n g(i) [\rm i~is~prime \vee p_k \lt minp(i)]$。

注意到 $1 \to n$ 的合数一定有一个 $\le \sqrt n$ 的质因子，那么 $F_{prime}(i) = g(i, \sqrt n)$，那么只需要求出 $g(?, \sqrt n)$ 即可，其中 $? = n/i$。

那么 $g(x, 0) = \sum_{i=2}^n g(i)$。

考虑 $k - 1$ 到 $k$，需要排除掉那些以 $p_{k}$ 为最小质因子的合数。
$$
g(x, k) = g(x, k - 1) - g(p_k)(g(x/p_k, k - 1) - g(p_{k-1}, k - 1))
$$
首先钦定了最小质因子，那就至少有一个 $g(p_k)$ 了，接下来相当于 $x/p_k$ 里选数，最小质因子 $\ge p_k$，然而我们的 $g(x/p_k, k - 1)$ 不仅仅包含最小质因子 $\ge p_k$ 的，还有一些质数，没有关系，减掉就好了。

需要注意的是，若 $p_k^2 \gt x$ 就直接继承即可，不需要继续筛。

