## A. roche

首先 ${\cal O}(n^2m^2q)$ 的 $20\rm pts$ 是显然的。

---

可以发现，最优决策下每一步要么 $x + 1$ 要么 $y + 1$，于是决策点减少到了线性，复杂度变成 ${\cal O}(n^3 q)$，可以发现的是，其合法决策点应该是连续的一段区间，每次暴力枚举属实不智，应当考虑更好的做法。

先考虑维护一行的最左点，一个矩形的影响相当于 $[c_1 + 1, c_2]$ 这些行，其中 $[r_1 + 1, r_2]$ 这些位置的 `left` 对 $r_1$ 取 `min`，最下点同理。

如果拿个线段树从右往左扫描就可以做到 $q \log n$ 的复杂度了，因为如果过了 $r_1$ 的话，其实取 $\min$ 就没有意义了，或者说，每个位置对自己的列取一下 `max` 即可，那么需要维护区间取 `min`，每一列暴力扫描整颗线段树，复杂度是 ${\cal O}(q \log n + nm)$，最下点同理。

然后每行每列维护一个单调队列，需要转移的时候插入信息，维护一个桶表示某个值的信息，转移即可。

[submission(0)](https://www.sjzezoj.com/submission/48367).（虽然是贺的

## B. graph

---

一个显然的 observation 就是一定会取满上下界，正数无边负数无边，考虑除了 $0$ 可能构成一个三元环，剩下的事二分图，于是先找出三元环并赋值，然后对于剩下的二分图，按照度数排序贪心之类的。

## C. game

若前缀最大值大于后缀最小值就会换，否则不换，而最后结果实质上等于操作 $1$ 次数，故最后结果数值上等于 $\max_i \lt min_{i + 1}$ 的 $i$ 个数，显然这就是 $\max_i = i$，根据期望的线性性，要求的就是调和级数。

那么现在要求的就是 $s_k(n)$($k$ 次前缀和的 $n$ 项)。

注意到 $-\ln(1 - x) = \sum_{i\ge 1} \dfrac{x^i}{i}$。

那么所求显然是 $[x^n]- \ln(1 - x) \dfrac{1}{(1-x)^{k + 1}}$。

求导就有：
$$
s^{(1)}_k(x) = \dfrac{1}{(1-x)^{k+2}} + (k+1) s_{k + 1}(x)
$$
导数和原函数的系数关系平凡，那么直接取 $[x^n]$ 就可以得到 $k$ 递降的递推式：
$$
[x^n] s_k(x) = [x^{n + 1}] s_{k-1}(x) \dfrac{n + 1}{k} - \dfrac{\binom{n + k}{k}}{k}
$$
直接暴力复杂度为 ${\cal O}(k^2)$，至于最底层，调和级数有一个近似公式：
$$
H(n) \sim \ln(n + 1) + \gamma
$$
其中 $\gamma$ 为欧拉-马歇罗尼常数，一般取 `0.5772156649` 即可(在 $n \ge 10^6$ 时)，你也可以大力计算巨大调和级数，和 $\ln$ 做差得到近似值(毕竟有计算机)。

另，本题中有公式 $ans = \dfrac{n^k}{k!}(H(n) - H(k))$，不过没有证明。

