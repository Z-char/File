## gym102331H

[gym102331h](https://codeforces.com/gym/102331/problem/H). 

~~书接上文~~。

考虑闵和来合并区间一定和区间长度有关，但我们只需要单点值所以确实太浪费了。

考虑单点求值通常使用 wqs 二分，考虑对于一组询问，外层大力二分代价，然后把 $\log n$ 个区间合并，具体的，设 $f(i, 0/1)$ 表示考虑了前 $i$ 个区间，右端点是否被选择的最大权值以及其选择个数，考虑合并 $i + 1$ 区间，枚举 $i + 1$ 区间左右端点的状态，此时凸包唯一确定，写出转移，发现前面的选择并不影响这个区间的选择，那么最大化这个区间的答案，可以直接在凸包上用斜率二分，总复杂度为 ${\cal O}(q \log n \log n \log w)$，一个是区间个数，一个是 wqs 二分，一个是每个区间都要二分切点，但因为合并过程中有巨大常数，未必可以通过。

考虑到切点只和斜率有关，可以整体处理，维护每个询问的 $[l, r]$，然后按 `mid` 降序排序，于是随着询问的处理，凸包上的切点单调不降，可以对于每个凸包维护一个指针，那么一次 wqs 二分指针移动的总复杂度只有 ${\cal O}(n \log n)$ 级别(线段树凸包长度和)，于是复杂度降至 ${\cal O}(n \log n \log w)$，可以通过。

犯了巨大降智错误，对拍 + 输出调试是好的。

## CF5E

[cf5E](https://www.luogu.com.cn/problem/CF5E). 

考虑把一个最大值提到前面重标号，这样后面的比自己小的通过向后找一定至多找到自己，于是就裂开，如果和自己一样高，一定可以往前找而不必绕，何故绕之？故只需要判断 $(1, i)$ 是否合法，剩下的问题就是链上问题了。

链上问题怎么做？直接维护单调栈，自己可以弹掉的可以和自己构成匹配，如果不能弹得和自己高度相同那么可以直接用 `cnt` 来统计，前面还有一个特殊的可以匹配，若特殊的或者同高度没有 $1$，那么特判一下 $(1, i)$。

## CF8E

[cf8E](https://www.luogu.com.cn/problem/CF8E). 

一个串如果大于取反串，那么一定大于另两个之一，所以可以不管取反串的限制。

现在的问题就是有多少个串满足同时小于等于逆序和逆反，由于要求 $kth$ 可以考虑按位贪心，若确定了前 $i$ 位后可以快速得到这一位是 $0$ 的方案数，就可快速确定这一位是什么。

考虑用数位 dp 求方案数，由于限制条件都是逆序串，可以考虑正反同步填，设 $f(i, j, k)$ 表示填了前后 $i$ 位，原串目前和逆序的关系，原串目前和逆反的关系，dp 即可。

## CF11D

[cf11d](https://codeforces.com/problemset/problem/11/D). 

设 $f(S, a, b)$ 表示选的集合为 $S$ 此时环的两端为 $a, b$ 的方案数，事实上这么做会算重，一个环会被其任意两点计算，那么考虑一个环钦定最小点计算，设 $f(S, a)$ 表示环包含集合 $S$，其中最小点是环的起点，终点是 $a$ 的方案数，枚举下一个点以扩展路径，若 $a$ 和最小点有连边可以直接统计答案，这样做仍然会算重，因为 $low \to 1 \to 2 \to 3$ 和 $low \to 3 \to 2 \to 1$ 是一个环，但这样每个环只会被计算两次，结果除以 $2$ 即可。

## CF11E

[cf11E](https://www.luogu.com.cn/problem/CF11E). 

可以先在两个相同的中间插入 `X`，保证序列合法。

此时序列一定是若干 `X` 划分开的 `LRL...` 或者 `RLR...` 段，一个段前面最多需要一个 `X` 就可以让整个段变得合法，而由于糖水不等式，分子分母同时加 $1$ 答案变大，何况分子的变化可能更大，于是直接贪心。

弱智了，想简单了，奇数长度会导致循环变得非常的奇怪，一段匹配一段不匹配，不过，还是由于糖水不等式，显然可以通过加入一个字符，使得答案更优，而且需要考虑首尾相同的情况。

于是加了两句特判，如果首尾相同且不会增加了，那么增加，然后，如果是奇数，那么增加，然后还是锅了，差 `1e-6`，仔细看了看，发现题目要保留下取整，那用 `long long` 下取整，然后平移过去，发现还是锅，然后原来是乘法的时候没转 `ll` 导致爆了。

~~然后过了 5 但是 6 锅了~~。

**但是这回是答案小了**。

明天再调。

