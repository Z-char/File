## CF1149D

[cf1149d](https://www.luogu.com.cn/problem/CF1149D). 

考虑 `kruskal` 加边的过程，先把 $a$ 权值放入图中，形成若干联通块，接下来放入 $b$ 边，每一个加入的 $b$ 边必然连接两个不同的 $a$ 块，那么一条路径能在最小晟晟树上，就需要满足 $a$ 边没啥所谓，走 $b$ 边的时候必须保证 $a$ 联通块不联通 $(u, v)$，同时，一个联通块如果已经走过了就不能再走回去。

那么直接设 $f(x, s)$ 表示走到 $x$，目前走过的联通块集合为 $s$ 的最短路，轻边转移同最短路，重边转移要求 $scc_u \neq scc_v$ 且 $bel_v \notin s$，由于权值很少，用 `bfs` 优化即可做到 $2^n n$ 的复杂度。

注意到如果一个联通块 $\le 3$，那么其实不用记录，因为若从这里走出去再走回来以期达到更有效果是不可能的，联通块直径只有 $2a$，而出去回来至少要 $2b$，故不记录直接跑最短路，也不会影响其答案，复杂度降至 ${\cal O}(2^{n/4}n)$，可以通过。

## CF1119F

[cf1119f](https://www.luogu.com.cn/problem/CF1119F). 

考虑对于每个 $k$ 暴力求。

设 $f(x, 0/1)$ 表示考虑完 $x$ 子树，$x$ 的父边是否钦定断开，子树内所有点的度数 $\le k$ 的最小权值和。

考虑如何贡献到 $x$，如果子树的 $f(y, 1) + w \le f(y, 0)$，我们一定会删除这条边，那么对于 $f(y, 1) + w \gt f(y, 0)$ 的儿子，我们先求出 $\sum f(y, 0)$，然后把 $f(y, 1) + w - f(y, 0)$ 插入小根堆，贪心选取直到度数符合限制即可。

时间复杂度为 ${\cal O}(n^2 \log n)$。

注意到枚举到 $k$ 时度数小于等于的就永远合法了，可以直接看作叶子扔到相邻的点上，每个块跑一遍 `dp` 然后求和即可。

可以证明，复杂度为 ${\cal O}(n \log n)$。

## LOJ6289

[loj6289](https://loj.ac/p/6289). 

先考虑暴力，设 $f(x, c, 0/1)$ 表示 $x$ 子树选了 $c$ 个点且 $x$ 是否选的乘积和。

转移考虑枚举 $c_1, c_2$，直接乘起来转移即可，要求不能同时选，发现这是一个 fft 的形式($\langle\times, +\rangle$ 卷积)。

具体的，初始化 $f_0(x) = 1, f_1(x) = B_i x$，转移为 $f_0(x) \times f_0(y) + f_0(x) \times f_1(y) \to f_0(x)$，$f_1(x) \times f_0(y) \to f_1(x)$。

暴力卷积显然不行，可以考虑链分治，具体的，先把一个点和所有轻儿子合并起来，这就是一个次数和确定的卷积，直接分治暴力乘即可，然后考虑处理一条链，直接把链拿出来，然后设 $g(l, r, 0/1, 0/1)$ 表示左是否匹配，直接在链上做即可，复杂度为 ${\cal O}(n \log ^3 n)$。

