模拟赛

## C. round

最长反链 = 最小链覆盖。

题目要求链覆盖 $\le 3$，那么也就是 `LDS` 长度 $\le 3$。

整了一个 ${\cal O}(n^4)$，常数应该比较小。

上一个前缀和优化就 ${\cal O}(n^3)$ 了。

## A. white

暴力怎么做？暴力是不是：矩乘，矩乘，矩乘，胡乱 dp！

具体来说：

搞出 $f(i, j)$ 表示一次旅行走 $i$ 答案为 $j$ 的方案数。

设 $g(i, j)$ 表示多次旅行答案为 $j$ 方案数，枚举最后一次步数，刷表即可。

复杂度为 ${\cal O}(mn^3 + m^2n^2)$，约为 $10^{12}$ 的计算量，对上 s2 评测机，**优势在我**！

## B. fat

$32768 = 2^{15}$。

考虑采用 `bfs` 序，那么一个修改可以拆成 $ 15 \times 15 \times 2$ 个线段树上的区间修改，但是难以求子树和。

采用 `dfs` 倒是可以求子树和，但是难以维护修改。

可以综合起来处理特殊性质，先用 `bfs` 修改，然后得出所有点权，按 `dfs` 重新建树，求值即可。

假了，开写暴力。

---

A 有一个显然的 `fwt` 优化，加上之后是 `55pts`，我单方面宣布这道题满分 `55pts`。

B 傻逼了，不是要求子树和，而是要求子树内非正数个数，那用线段树维护 `bfs` 序，暴力修改，维护最小值，若最小值 $\le 0$，暴力找出这个最小值，改成 `inf`，插入 `dfs` 序中即可，每个点只会插入一次，所以总复杂度是 ${\cal O}((n + q) \log n \log^2V)$。

不过上面说的假是因为发现无法精确定位 `bfs` 区间，不过那个是写法问题，换一个写法即可，所以预备重构（

---

## CF1034E

[cf1034e](https://codeforces.com/problemset/problem/1034/E). 

不难发现这就是一个子集卷积，然而 $n \le 21$ 的数据范围让人望而却步。

考虑利用题目中不同于一般子集卷积的性质，其值域。

令 $A_i = 4^{\rm popcount(i)} a_i$，$B_i$ 同理，直接做或卷积。

那么 $c_i = C_i /\rm popcount(i)$。

不难发现是正确的，因为若贡献到 $i$ 的两个集合无交，那么系数恰好贡献 `popcount(i)`，否则，前面的系数一定会多一些 $4$，这就意味着模 $4$ 意义下，那些东西就被干掉了。

需要注意，过程中是不能取模的。

复杂度为 ${\cal O}(2^n n)$。

`scanf("%01d")` 实在是太慢了，以及不开 `ull` 似乎会被卡掉。

[Submission(2)](https://codeforces.com/contest/1034/submission/146341779). 

## CF1326F2

[cf1326f2](https://codeforces.com/problemset/problem/1326/F2). 

考虑 $f(s)$ 表示 $s$ 集合都是 $1$，其他部分不限制的方案数。

若能求出 $f$ 数组，做 `ifwt_and` 即可还原回原数组。

考虑 $f(s)$ 其实相当于从原图中取出若干不相交的链，恰覆盖全图的方案数。

譬如说 $s = \{0, 1, 1, 1, 0, 0, 1\}$，对应的链长度就是 $1, 4, 1, 2$。

